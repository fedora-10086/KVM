 KVM常用命令

virsh list --all     查看虚拟机状态
virsh start kvm01  开机
virsh shutdown kvm01   关机（虚拟机需开启acpid服务）
virsh destroy kvm01   强制开机
virsh suspend kvm01 挂起虚拟机
virsh resume kvm01  恢复挂起的虚拟机
virsh snapshot-create kvm01  建虚拟机快照（建快照镜像格式要为qcow2格式）
virsh snapshot-list kvm01       查看虚拟机快照
virsh snapshot-revert kvm01 1489386302 恢复虚拟机快照
virsh edit kvm01      编辑配置文件
virsh autostart kvm01      设置物理机开机自动启动虚拟机
virsh dumpxml kvm01 > kvm01.xml 导出虚拟机配置文件
/etc/libvirt/qemu/            虚拟机配置文件默认目录
virsh undefine kvm01    删除一个虚拟机（会一起删除配置文件，镜像不删除）
virsh define /etc/libvirt/qemu/kvm01.xml     重新定义一个虚拟机
virt-clone -o kvm01 -n kvm02 -f  /var/lib/libvirt/images/kvm02.img 克隆虚拟机（/etc/udev/rules.d/70-persistent-net.rules启动后删除）
qemu-img info kvm01       查看虚拟机镜像格式

qemu-img convert -f raw -O qcow2 kvm01.img kvm01.qcow2    转换虚拟机镜像格式

qemu-img create -f qcow2  /var/lib/libvirt/images/kvm01-1.img 20G      新建虚拟机镜像磁盘
virsh attach-disk kvm01 /var/lib/libvirt/images/kvm01-1.img vdb --cache=none --subdriver=qcow2    在线添加虚拟机镜像硬盘


virt-clone -o vm01 -n vm02 -f /opt/kvmimg/vm02.img     //克隆vm02

virsh edit vm02        //修改vm02.xml文件，因为vm01的vnc已经把5900端口占用所以需要换一下，我这里修改成6900

<graphics type='vnc' port='6900' autoport='no' listen='0.0.0.0'>

4）virsh start vm02       //启动vm02

5）利用vnc登录到vm02之后，有些网络设置需要修改，否则网卡无法启动

cat /etc/sysconfig/network-scripts/ifcfg-eth0     //删除mac地址和uuid那一行

DEVICE=eth0

TYPE=Ethernet

ONBOOT=yes

NM_CONTROLLED=yes

BOOTPROTO=dhcp


cat /etc/udev/rules.d/70-persistent-net.rules    //把之前的"SUBSYSTEM=="这一行注释掉，把新的那行的eth1换成eth0

# This file was automatically generated by the /lib/udev/write_net_rules

# program, run by the persistent-net-generator.rules rules file.

#

# You can modify it, as long as you keep each rule on a single

# line, and change only the value of the NAME= key.


# PCI device 0x1af4:0x1000 (virtio-pci)

#SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", ATTR{address}=="52:54:00:72:69:a1", ATTR{type}=="1", KERNEL=="eth*", NAME="eth0"

# PCI device 0x1af4:0x1000 (virtio-pci)

SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", ATTR{address}=="52:54:00:f8:e5:86", ATTR{type}=="1", KERNEL=="eth*", NAME="eth0"

重启vm02，重启网络        //至此，大功告成！
 

1）virsh list 列出当前虚拟机列表，不包括未启动的

2）virsh list --all 列出所有虚拟机，包括所有已经定义的虚拟机

3）virsh destroy vm-name 关闭虚拟机

4）virsh start vm-name 启动虚拟机

5）virsh edit vm-name 编辑虚拟机xml文件

6）virsh undefine vm-name 删除虚拟机

7）virsh shutdown vm-name 停止虚拟机

8）virsh reboot vm-name 重启虚拟机

9）virsh autostart vm-name 虚拟机随宿主机启动
